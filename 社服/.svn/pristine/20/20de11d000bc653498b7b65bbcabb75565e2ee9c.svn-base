// pages/detail/detail.js
const app = getApp();
Page({

  /**
   * 页面的初始数据
   */
  data: {
    detail:{},
    dTimer:"00天 00:00:00",
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    this.getDetail( options.id )
  },
  getDetail( aid ){
    wx.request({
      data:{ aid },
      url: app.globalData.url.CHEER,
      success: res => {
        let { code, data } = res.data.data;
        if( code === 200 ){
          this.setData({ detail: data })
          this.setTime()
        } 
        console.log('detail pages', data )
      }
    })
  },
  setTime(){
    let timer = null,
    str = '活动距离结束还有',
    total = this.data.detail.end_time;
    clearInterval( timer );
    timer = setInterval( () => {
      total--;
      let s = total % 60;
      let m = ~~((total / 60 )% 60);
      let h = ~~(( total / 3600) % 24 );
      let d = ~~( total / 86400 );
      s = s > 9 ? s : '0' + s;
      m = m > 9 ? m : '0' + m;
      h = h > 9 ? h : '0' + h;
      d = d > 9 ? d : '0' + d;
      str = d + '天 ' + [ h, m, s ].join(":");
      this.setData({ dTimer: str })
    },1000)
  },
  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  }
})